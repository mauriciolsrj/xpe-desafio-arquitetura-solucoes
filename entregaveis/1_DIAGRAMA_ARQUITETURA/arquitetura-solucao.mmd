graph TB
    subgraph "Usu√°rios"
        Users["Usu√°rios / Clientes"]
    end

    Users -->|Requisi√ß√µes HTTPS| GLB["üåê Balanceador de Carga<br/>Global Externo<br/>(GCP: Cloud Load Balancing)<br/>(130.211.0.0/22, 35.191.0.0/16)"]

    GLB -->|Rota Tr√°fego| CA["üõ°Ô∏è Prote√ß√£o contra Ataques<br/>(GCP: Cloud Armor)<br/>(SQLi + XSS Protection)"]

    CA -->|Filtra & Encaminha| MIG["üì¶ Grupo de Inst√¢ncias<br/>Gerenciadas Regional<br/>(GCP: Managed Instance Group)<br/>(Multi-Zona)"]

    subgraph "vpc-ecommerce"
        subgraph "us-central1 (3 Zonas)"
            MIG --> Zone_A["Zona A (us-central1-a)<br/>Inst√¢ncias 1-2<br/>Ubuntu 22.04 LTS<br/>Nginx + Aplica√ß√£o"]
            MIG --> Zone_B["Zona B (us-central1-b)<br/>Inst√¢ncias 1-2<br/>Ubuntu 22.04 LTS<br/>Nginx + Aplica√ß√£o"]
            MIG --> Zone_C["Zona C (us-central1-c)<br/>Inst√¢ncias 1-2<br/>Ubuntu 22.04 LTS<br/>Nginx + Aplica√ß√£o"]
        end

        subgraph "Regras de Firewall"
            FR1["IPs do LB: 130.211.0.0/22, 35.191.0.0/16<br/>(Portas: 80, 443, 8080)"]
            FR2["Interno: 10.0.1.0/24<br/>(Todas as Portas)"]
            FR3["IAP SSH: 35.235.240.0/20<br/>(Porta 22)"]
        end

        Zone_A ==>|Conex√µes ao Banco| PSC["üîí Conex√£o de Servi√ßo<br/>Privada<br/>(GCP: Private Service Connect)"]
        Zone_B ==>|Conex√µes ao Banco| PSC
        Zone_C ==>|Conex√µes ao Banco| PSC
    end

    PSC -->|IP Privado| SQL_Primary["üóÑÔ∏è Banco de Dados Prim√°rio<br/>(GCP: Cloud SQL)<br/>PostgreSQL 15<br/>Alta Disponibilidade Regional<br/>us-central1"]

    SQL_Primary -.->|Replica√ß√£o Ass√≠ncrona<br/>Cross-Region| SQL_Replica["üóÑÔ∏è Banco de Dados Replica<br/>(GCP: Cloud SQL)<br/>(Somente Leitura)<br/>us-east1<br/>(Recupera√ß√£o de Desastres)"]

    SQL_Primary -->|Backups Autom√°ticos<br/>Recupera√ß√£o Point-in-Time| Backups["üíæ Backups Autom√°ticos<br/>(GCP: Cloud SQL Backups)<br/>(Reten√ß√£o: 7 dias)<br/>(30 snapshots)"]

    subgraph "Monitoramento & Observabilidade"
        Ops_Agent["Agente Ops<br/>(GCP: Ops Agent)<br/>(M√©tricas + Logs)"]
        Monitoring["Monitoramento<br/>(GCP: Cloud Monitoring)<br/>(SLI: P99 < 500ms<br/>Taxa de Erro < 1%)"]
        Logging["Registros<br/>(GCP: Cloud Logging)<br/>(Syslog, Logs App)"]
    end

    Zone_A -.->|M√©tricas| Ops_Agent
    Zone_B -.->|M√©tricas| Ops_Agent
    Zone_C -.->|M√©tricas| Ops_Agent
    
    Ops_Agent -.-> Monitoring
    Ops_Agent -.-> Logging

    subgraph "Seguran√ßa & Identidade"
        IAM["Controle de Acesso<br/>(GCP: Cloud IAM)<br/>Service Account<br/>Roles:<br/>‚Ä¢ cloudsql.client<br/>‚Ä¢ logging.logWriter<br/>‚Ä¢ monitoring.metricWriter"]
    end

    Zone_A -.->|Utiliza| IAM
    Zone_B -.->|Utiliza| IAM
    Zone_C -.->|Utiliza| IAM

    subgraph "Escalonamento Autom√°tico"
        Autoscaler["Auto-escalador<br/>(GCP: Autoscaling)<br/>M√≠nimo: 3 Inst√¢ncias<br/>M√°ximo: 6 Inst√¢ncias<br/>Meta de CPU: 70%<br/>Controle de Scale-down: 1 inst/10 min"]
    end

    MIG -.->|Gerenciado por| Autoscaler

    style GLB fill:#4285F4,stroke:#1a73e8,color:#fff
    style CA fill:#EA4335,stroke:#c5221f,color:#fff
    style MIG fill:#34A853,stroke:#137333,color:#fff
    style SQL_Primary fill:#FBBC04,stroke:#9c6c00,color:#000
    style SQL_Replica fill:#FBBC04,stroke:#9c6c00,color:#000
    style Monitoring fill:#9C27B0,stroke:#6a1b9a,color:#fff
    style Logging fill:#9C27B0,stroke:#6a1b9a,color:#fff
    style IAM fill:#FF6F00,stroke:#e65100,color:#fff
    style Autoscaler fill:#00BCD4,stroke:#00838f,color:#fff
